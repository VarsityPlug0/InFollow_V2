<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Instagram Barter System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background: #fafafa; color: #262626; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        h1 { font-size: 32px; }
        .logout-btn { padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: 600; cursor: pointer; text-decoration: none; display: inline-block; }
        .logout-btn:hover { background: #c82333; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: white; border: 1px solid #dbdbdb; border-radius: 8px; padding: 20px; text-align: center; }
        .stat-card .label { color: #8e8e8e; font-size: 14px; margin-bottom: 5px; }
        .stat-card .value { font-size: 28px; font-weight: 600; color: #0095f6; }
        .section { background: white; border: 1px solid #dbdbdb; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .section h2 { font-size: 20px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #dbdbdb; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; }
        th { background: #f8f9fa; text-align: left; padding: 12px; font-weight: 600; border-bottom: 2px solid #dbdbdb; }
        td { padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .status-unused { background: #d4edda; color: #155724; }
        .status-used { background: #f8d7da; color: #721c24; }
        .tier-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .tier-free { background: #fff3cd; color: #856404; }
        .tier-donation { background: #d1ecf1; color: #0c5460; }
        .result-badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
        .result-success { background: #d4edda; color: #155724; }
        .result-error { background: #f8d7da; color: #721c24; }
        .result-already { background: #fff3cd; color: #856404; }
        .remove-btn { padding: 6px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; }
        .remove-btn:hover { background: #c82333; }
        .empty { text-align: center; color: #8e8e8e; padding: 20px; font-size: 14px; }
        .scroll-table { overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Admin Dashboard</h1>
            <a href="/admin/logout" class="logout-btn">Logout</a>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">Total Accounts</div>
                <div class="value">{{ stats.total_accounts }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Unused Accounts</div>
                <div class="value" style="color: #28a745;">{{ stats.unused_accounts }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Used Accounts</div>
                <div class="value" style="color: #dc3545;">{{ stats.used_accounts }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Total Targets</div>
                <div class="value">{{ stats.total_targets }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Free Test Targets</div>
                <div class="value">{{ stats.free_test_targets }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Donation Targets</div>
                <div class="value">{{ stats.donation_targets }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Total Actions</div>
                <div class="value">{{ stats.total_actions }}</div>
            </div>
            <div class="stat-card">
                <div class="label">Successful Actions</div>
                <div class="value" style="color: #28a745;">{{ stats.successful_actions }}</div>
            </div>
        </div>

        <div class="section">
            <h2>üì± Donated Accounts</h2>
            {% if accounts %}
            <div class="scroll-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Status</th>
                            <th>Tier Used</th>
                            <th>Donated At</th>
                            <th>Used At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for account in accounts %}
                        <tr>
                            <td>{{ account.id }}</td>
                            <td><strong>@{{ account.username }}</strong></td>
                            <td>
                                {% if account.status == 'unused' %}
                                <span class="status-badge status-unused">{{ account.status }}</span>
                                {% else %}
                                <span class="status-badge status-used">{{ account.status }}</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if account.tier_used == 'free_test' %}
                                <span class="tier-badge tier-free">FREE TEST</span>
                                {% elif account.tier_used == 'donation' %}
                                <span class="tier-badge tier-donation">DONATION</span>
                                {% else %}
                                -
                                {% endif %}
                            </td>
                            <td>{{ account.donated_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>{{ account.used_at.strftime('%Y-%m-%d %H:%M') if account.used_at else '-' }}</td>
                            <td>
                                <button class="remove-btn" onclick="removeAccount({{ account.id }}, '{{ account.username }}')">Remove</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty">No donated accounts yet</div>
            {% endif %}
        </div>

        <div class="section">
            <h2>üéØ Targets</h2>
            {% if targets %}
            <div class="scroll-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Username</th>
                            <th>Tier</th>
                            <th>Burned</th>
                            <th>Created At</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for target in targets %}
                        <tr>
                            <td>{{ target.id }}</td>
                            <td><strong>@{{ target.username }}</strong></td>
                            <td>
                                {% if target.tier == 'free_test' %}
                                <span class="tier-badge tier-free">FREE TEST</span>
                                {% else %}
                                <span class="tier-badge tier-donation">DONATION</span>
                                {% endif %}
                            </td>
                            <td>{{ '‚úÖ Yes' if target.burned else '‚ùå No' }}</td>
                            <td>{{ target.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty">No targets yet</div>
            {% endif %}
        </div>

        <div class="section">
            <h2>üìä Action Logs (Last 100)</h2>
            {% if logs %}
            <div class="scroll-table">
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Donor Account</th>
                            <th>Target</th>
                            <th>Tier</th>
                            <th>Result</th>
                            <th>Error</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for log in logs %}
                        <tr>
                            <td>{{ log.id }}</td>
                            <td>@{{ log.donor_account }}</td>
                            <td><strong>@{{ log.target }}</strong></td>
                            <td>
                                {% if log.tier == 'free_test' %}
                                <span class="tier-badge tier-free">FREE TEST</span>
                                {% else %}
                                <span class="tier-badge tier-donation">DONATION</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if log.result == 'success' %}
                                <span class="result-badge result-success">SUCCESS</span>
                                {% elif log.result == 'already_followed' %}
                                <span class="result-badge result-already">ALREADY FOLLOWING</span>
                                {% else %}
                                <span class="result-badge result-error">ERROR</span>
                                {% endif %}
                            </td>
                            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                {{ log.error if log.error else '-' }}
                            </td>
                            <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="empty">No action logs yet</div>
            {% endif %}
        </div>
    </div>

    <script>
        async function removeAccount(accountId, username) {
            if (!confirm(`Are you sure you want to remove account @${username}?`)) {
                return;
            }

            try {
                const response = await fetch(`/admin/remove-account/${accountId}`, {
                    method: 'POST'
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message);
                    location.reload();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Network error');
            }
        }
    </script>
</body>
</html>
